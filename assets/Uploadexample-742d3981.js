import{d as P,r as p,f as W,o as M,c as N,a as t,j as T,b as a,H as K,t as o,F as q,x as G,U,V as X,w as y,v as J,i as Q,h as S,E as v,m as Y,p as Z,e as ee,W as se,_ as te}from"./index-370997d1.js";const E=g=>(Z("data-v-00610ae3"),g=g(),ee(),g),ne={class:"example-container"},le={class:"info-top"},ae=E(()=>t("span",null,"将目录或多个文件拖拽到此进行扫描",-1)),oe={class:"upload-opts"},ue={class:"upload-content"},re=E(()=>t("div",{class:"content-header"},[t("span",null,"文件名"),t("span",null,"类型"),t("span",null,"大小"),t("span",null,"状态"),t("span",null,"操作")],-1)),pe=["value"],ie={class:"progress"},ce={class:"progress-etr"},de={class:"upload-info"},fe=P({__name:"Uploadexample",setup(g){const _=p(),m=p(),i=p([]);let x=p(0),b=p(0),c=p(0),w=4;const d=[];let f=p(3),k=p(!1),l=f.value;const C=[".jpg",".jpeg",".bmp",".webp",".gif",".png",".mp3",".mp4"];W(()=>{m.value.ondragenter=function(s){s.preventDefault()},m.value.ondragover=function(s){s.preventDefault()},m.value.ondrop=function(s){s.preventDefault();for(const n of s.dataTransfer.items){const e=n.webkitGetAsEntry();j(e)}}});const I=s=>{s==="only"||s==="mutiple"&&_.value.setAttribute("webkitdirectory",""),_.value.click()},$=s=>{let n=s.target.files;if(n.length!==0){if(n.length===1){let e=n[0];z(e)}else Array.from(n).map(e=>{z(e)});s.target.value=""}},D=s=>{s==="only"||s==="mutiple"&&_.value.removeAttribute("webkitdirectory")},z=s=>{if(!A(s)){let e="."+s.name.split(".").pop();v({showClose:!0,message:"您选择的类型为"+e+"。Warning, 仅支持文件的类型："+C.join("、"),type:"warning"});return}let n=new FileReader;n.onload=function(e){var r;let u=(r=e.target)==null?void 0:r.result;i.value.push({name:s.name,type:"."+s.name.split(".").pop(),size:s.size,status:"pending",progress:0,result:u,success:!1,t1:null,t2:null}),x.value=i.value.length,c.value+=s.size},n.readAsDataURL(s)},j=s=>{s.isDirectory?s.createReader().readEntries(e=>{for(let u of e)j(u)}):s.file(n=>{z(n)})},A=s=>{if(C.indexOf("."+s.name.split(".").pop())!==-1)return!0},O=s=>{clearTimeout(s.t1),clearInterval(s.t2),s.status==="pending"?v({showClose:!0,message:"Oops, 删除成功.",type:"error"}):s.status==="upload"?(s.abort1?s.abort1():s.abort2(),v({showClose:!0,message:"Oops, 停止上传, 并删除成功.",type:"error"})):s.status==="success"&&(b.value--,v({showClose:!0,message:"Oops, 撤销上传, 成功删除服务器文件.",type:"error"})),i.value.splice(i.value.findIndex(n=>n==s),1),x.value--,c.value-=s.size},R=async()=>{let s=i.value.filter(e=>!e.success&&e.status!=="upload");if(!s.length){if(d.length){v({showClose:!0,message:"Success, 所有文件已在下载队列中！",type:"success"});return}v({showClose:!0,message:"Warning, 还没有选择文件。",type:"warning"});return}s.map(e=>{e.status="upload",e.size>1024*1024*w&&setTimeout(()=>{e.status="error文件太大"},250),e.abort2=()=>{let u=s.findIndex(r=>r==e);s.splice(u,1)}}),(async()=>{for(let e of s){if(e.size>1024*1024*w)continue;let u=5+Math.ceil(Math.random()*9);const r=new XMLHttpRequest,B=new Promise(h=>{r.onload=function(F){clearInterval(e.t2),e.status="success",e.success=!0,b.value++},r.open("POST","/upload/upload"),e.abort1=()=>{h("请求被删除")},e.t2=setInterval(()=>{e.progress=parseInt(e.progress+100/u)},1e3),e.t1=setTimeout(()=>{r.send(),h("上传成功")},u*1e3)});for(B.then(h=>{let F=d.findIndex(L=>L==B);d.splice(F,1),console.log(h)}),d.push(B);d.length>=f.value;)await Promise.race(d)}})()},V=s=>{k.value=!0},H=()=>{Number.isNaN(Number(l))||!l?l=f.value:(l=parseInt(l),l<1?l=1:l>10&&(l=10),l!==f.value&&(f.value=l,Y({title:"Success",message:`小爱同学会在‘完成一个正在上传任务后’为您同步设置‘同时上传任务数量为${f.value}’`,type:"success"}))),k.value=!1};return(s,n)=>(M(),N("div",ne,[t("div",{ref_key:"select",ref:m,class:"upload-area",onClick:n[0]||(n[0]=e=>I("none"))},[t("span",le,[T(a(K),{class:"icon1"}),ae]),t("span",null,"支持文件的类型："+o(C.join("、")),1),t("span",null,"每个文件允许的最大尺寸："+o(a(w))+"M",1),t("input",{ref_key:"ipt",ref:_,type:"file",title:"",onChange:$,multiple:"",accept:".jpg,.jpeg,.bmp,.webp,.gif,.png,.mp3,.mp4"},null,544)],512),t("div",oe,[t("button",{onClick:n[1]||(n[1]=e=>I("only")),onBlur:n[2]||(n[2]=e=>D("only"))}," 选择文件 ",32),t("button",{onClick:n[3]||(n[3]=e=>I("mutiple")),onBlur:n[4]||(n[4]=e=>D("mutiple"))}," 选择文件夹 ",32)]),t("div",ue,[re,(M(!0),N(q,null,G(i.value,(e,u)=>(M(),N("div",{class:"content-main",key:u},[t("span",null,o(e.name),1),t("span",null,o(e.type),1),t("span",null,o(e.size/1024/1024>1?(e.size/1024/1024).toFixed(2)+"MB":e.size/1024>1?(e.size/1024).toFixed(2)+"KB":e.size+"bype"),1),t("span",null,[y(t("span",{class:U({"content-status":!0,pending:e.status==="pending",success:e.status==="success",error:e.status.slice(0,5)==="error"})},o(e.status==="pending"?"待上传":e.status==="success"?"已上传":e.status.slice(5)),3),[[S,e.status!=="upload"]]),y(t("span",null,[t("progress",{max:"100",value:e.progress},null,8,pe),t("span",ie,o(e.progress)+"%",1),t("span",ce,o(e.progress===0?"待上传":"上传中"),1)],512),[[S,e.status==="upload"]])]),t("span",null,[T(a(se),{class:"icon2",onClick:r=>O(e)},null,8,["onClick"])])]))),128))]),t("div",de,[t("span",null,"文件数量："+o(a(x)),1),t("span",null,"成功上传："+o(a(b)),1),t("span",null,"总大小："+o(a(c)/1024/1024>1?(a(c)/1024/1024).toFixed(2)+"MB":a(c)/1024>1?(a(c)/1024).toFixed(2)+"KB":a(c)+"bype"),1),t("button",{class:U({isenable:!!i.value.length}),onClick:R}," 开始上传 ",2),t("span",null,[X("同时上传数量："),y(t("input",{type:"text","onUpdate:modelValue":n[5]||(n[5]=e=>Q(l)?l.value=e:l=e),onInput:V},null,544),[[J,a(l)]])]),y(t("button",{class:"confirm",onClick:H}," 确定 ",512),[[S,a(k)]])])]))}});const ge=te(fe,[["__scopeId","data-v-00610ae3"]]);export{ge as default};
