import{d as j,r as p,f as A,c as y,a as n,l as I,b as l,t as a,F as E,s as O,$ as B,E as g,o as b,G as U,w as z,h as D,T as R,p as L,e as N,_ as G}from"./index-dea78184.js";const M=i=>(L("data-v-d54764ee"),i=i(),N(),i),K={class:"content-container"},V={class:"info-top"},q=M(()=>n("span",null,"将目录或多个文件拖拽到此进行扫描",-1)),H={class:"upload-opts"},P={class:"upload-content"},W=M(()=>n("div",{class:"content-header"},[n("span",null,"文件名"),n("span",null,"类型"),n("span",null,"大小"),n("span",null,"状态"),n("span",null,"操作")],-1)),X=["value"],J={class:"progress"},Q={class:"upload-info"},Y=j({__name:"Upload",setup(i){const c=p(),d=p(),u=p([]);let v=p(0),_=p(0),r=p(0),k=3;const w=[".jpg",".jpeg",".bmp",".webp",".gif",".png",".mp3",".mp4"];A(()=>{d.value.ondragenter=function(e){e.preventDefault()},d.value.ondragover=function(e){e.preventDefault()},d.value.ondrop=function(e){e.preventDefault();for(const s of e.dataTransfer.items){const t=s.webkitGetAsEntry();x(t)}}});const m=e=>{e==="only"||e==="mutiple"&&c.value.setAttribute("webkitdirectory",""),c.value.click()},$=e=>{let s=e.target.files;if(s.length!==0){if(s.length===1){let t=s[0];h(t)}else Array.from(s).map(t=>{h(t)});e.target.value=""}},C=e=>{e==="only"||e==="mutiple"&&c.value.removeAttribute("webkitdirectory")},h=e=>{if(!F(e))return;let s=new FileReader;s.onload=function(t){var f;let o=(f=t.target)==null?void 0:f.result;u.value.push({name:e.name,type:"."+e.name.split(".").pop(),size:e.size,status:"pending",progress:0,result:o,success:!1,t1:null,t2:null}),v.value=u.value.length,r.value+=e.size},s.readAsDataURL(e)},x=e=>{e.isDirectory?e.createReader().readEntries(t=>{for(let o of t)x(o)}):e.file(s=>{h(s)})},F=e=>{if(w.indexOf("."+e.name.split(".").pop())!==-1)return!0},S=e=>{clearTimeout(e.t1),clearInterval(e.t2),e.status==="pending"?g({showClose:!0,message:"Oops, 删除成功.",type:"error"}):e.status==="upload"?g({showClose:!0,message:"Oops, 停止上传, 并删除成功.",type:"error"}):e.status==="success"&&(_.value--,g({showClose:!0,message:"Oops, 撤销上传, 成功删除服务器文件.",type:"error"})),u.value.splice(u.value.findIndex(s=>s==e),1),v.value--,r.value-=e.size},T=()=>{let e=u.value.filter(s=>!s.success);e.length||g({showClose:!0,message:"Warning, 还没有选择文件。",type:"warning"}),e.map(s=>{let t=5+Math.ceil(Math.random()*9);const o=new XMLHttpRequest;if(s.status="upload",s.size>1024*1024*k){setTimeout(()=>{s.status="error文件太大"},250);return}o.onload=function(f){clearInterval(s.t2),s.status="success",s.success=!0,_.value++},o.open("POST","/upload/upload"),s.t2=setInterval(()=>{s.progress=parseInt(s.progress+100/t)},1e3),s.t1=setTimeout(()=>{o.send()},t*1e3)})};return(e,s)=>(b(),y("div",K,[n("div",{ref_key:"select",ref:d,class:"upload-area",onClick:s[0]||(s[0]=t=>m("none"))},[n("span",V,[I(l(U),{class:"icon1"}),q]),n("span",null,"支持文件的类型："+a(w.join("、")),1),n("span",null,"每个文件允许的最大尺寸："+a(l(k))+"M",1),n("input",{ref_key:"ipt",ref:c,type:"file",title:"",onChange:$,multiple:"",accept:".jpg,.jpeg,.bmp,.webp,.gif,.png,.mp3,.mp4"},null,544)],512),n("div",H,[n("button",{onClick:s[1]||(s[1]=t=>m("only")),onBlur:s[2]||(s[2]=t=>C("only"))},"选择文件",32),n("button",{onClick:s[3]||(s[3]=t=>m("mutiple")),onBlur:s[4]||(s[4]=t=>C("mutiple"))},"选择文件夹",32)]),n("div",P,[W,(b(!0),y(E,null,O(u.value,(t,o)=>(b(),y("div",{class:"content-main",key:o},[n("span",null,a(t.name),1),n("span",null,a(t.type),1),n("span",null,a((t.size/1024).toFixed(2))+"KB",1),n("span",null,[z(n("span",{class:B({"content-status":!0,pending:t.status==="pending",success:t.status==="success",error:t.status.slice(0,5)==="error"})},a(t.status==="pending"?"待上传":t.status==="success"?"已上传":t.status.slice(5)),3),[[D,t.status!=="upload"]]),z(n("span",null,[n("progress",{max:"100",value:t.progress},null,8,X),n("span",J,a(t.progress)+"%",1)],512),[[D,t.status==="upload"]])]),n("span",null,[I(l(R),{class:"icon2",onClick:f=>S(t)},null,8,["onClick"])])]))),128))]),n("div",Q,[n("span",null,"文件数量："+a(l(v)),1),n("span",null,"成功上传："+a(l(_)),1),n("span",null,"总大小："+a(l(r)/1024/1024>1?(l(r)/1024/1024).toFixed(2)+"MB":l(r)/1024>1?(l(r)/1024).toFixed(2)+"KB":l(r)+"bype"),1),n("button",{class:B({isenable:!!u.value.length}),onClick:T},"开始上传",2)])]))}});const ee=G(Y,[["__scopeId","data-v-d54764ee"]]);export{ee as default};
