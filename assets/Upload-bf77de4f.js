import{d as T,r as p,f as A,c as w,a as n,l as I,b as a,t as l,F as E,s as O,$ as B,E as i,o as b,G as U,w as z,h as D,T as R,p as L,e as N,_ as G}from"./index-c05b8bcf.js";const M=c=>(L("data-v-e6054a79"),c=c(),N(),c),K={class:"content-container"},V={class:"info-top"},W=M(()=>n("span",null,"将目录或多个文件拖拽到此进行扫描",-1)),q={class:"upload-opts"},H={class:"upload-content"},P=M(()=>n("div",{class:"content-header"},[n("span",null,"文件名"),n("span",null,"类型"),n("span",null,"大小"),n("span",null,"状态"),n("span",null,"操作")],-1)),X=["value"],J={class:"progress"},Q={class:"upload-info"},Y=T({__name:"Upload",setup(c){const d=p(),f=p(),r=p([]);let v=p(0),_=p(0),u=p(0),k=3;const m=[".jpg",".jpeg",".bmp",".webp",".gif",".png",".mp3",".mp4"];A(()=>{f.value.ondragenter=function(e){e.preventDefault()},f.value.ondragover=function(e){e.preventDefault()},f.value.ondrop=function(e){e.preventDefault();for(const s of e.dataTransfer.items){const t=s.webkitGetAsEntry();x(t)}}});const h=e=>{e==="only"||e==="mutiple"&&d.value.setAttribute("webkitdirectory",""),d.value.click()},$=e=>{let s=e.target.files;if(s.length!==0){if(s.length===1){let t=s[0];y(t)}else Array.from(s).map(t=>{y(t)});e.target.value=""}},C=e=>{e==="only"||e==="mutiple"&&d.value.removeAttribute("webkitdirectory")},y=e=>{if(!j(e)){let t="."+e.name.split(".").pop();i({showClose:!0,message:"您选择的类型为"+t+"。Warning, 仅支持文件的类型："+m.join("、"),type:"warning"});return}let s=new FileReader;s.onload=function(t){var g;let o=(g=t.target)==null?void 0:g.result;r.value.push({name:e.name,type:"."+e.name.split(".").pop(),size:e.size,status:"pending",progress:0,result:o,success:!1,t1:null,t2:null}),v.value=r.value.length,u.value+=e.size},s.readAsDataURL(e)},x=e=>{e.isDirectory?e.createReader().readEntries(t=>{for(let o of t)x(o)}):e.file(s=>{y(s)})},j=e=>{if(m.indexOf("."+e.name.split(".").pop())!==-1)return!0},F=e=>{clearTimeout(e.t1),clearInterval(e.t2),e.status==="pending"?i({showClose:!0,message:"Oops, 删除成功.",type:"error"}):e.status==="upload"?i({showClose:!0,message:"Oops, 停止上传, 并删除成功.",type:"error"}):e.status==="success"&&(_.value--,i({showClose:!0,message:"Oops, 撤销上传, 成功删除服务器文件.",type:"error"})),r.value.splice(r.value.findIndex(s=>s==e),1),v.value--,u.value-=e.size},S=()=>{let e=r.value.filter(s=>!s.success);e.length||i({showClose:!0,message:"Warning, 还没有选择文件。",type:"warning"}),e.map(s=>{let t=5+Math.ceil(Math.random()*9);const o=new XMLHttpRequest;if(s.status="upload",s.size>1024*1024*k){setTimeout(()=>{s.status="error文件太大"},250);return}o.onload=function(g){clearInterval(s.t2),s.status="success",s.success=!0,_.value++},o.open("POST","/upload/upload"),s.t2=setInterval(()=>{s.progress=parseInt(s.progress+100/t)},1e3),s.t1=setTimeout(()=>{o.send()},t*1e3)})};return(e,s)=>(b(),w("div",K,[n("div",{ref_key:"select",ref:f,class:"upload-area",onClick:s[0]||(s[0]=t=>h("none"))},[n("span",V,[I(a(U),{class:"icon1"}),W]),n("span",null,"支持文件的类型："+l(m.join("、")),1),n("span",null,"每个文件允许的最大尺寸："+l(a(k))+"M",1),n("input",{ref_key:"ipt",ref:d,type:"file",title:"",onChange:$,multiple:"",accept:".jpg,.jpeg,.bmp,.webp,.gif,.png,.mp3,.mp4"},null,544)],512),n("div",q,[n("button",{onClick:s[1]||(s[1]=t=>h("only")),onBlur:s[2]||(s[2]=t=>C("only"))},"选择文件",32),n("button",{onClick:s[3]||(s[3]=t=>h("mutiple")),onBlur:s[4]||(s[4]=t=>C("mutiple"))},"选择文件夹",32)]),n("div",H,[P,(b(!0),w(E,null,O(r.value,(t,o)=>(b(),w("div",{class:"content-main",key:o},[n("span",null,l(t.name),1),n("span",null,l(t.type),1),n("span",null,l((t.size/1024).toFixed(2))+"KB",1),n("span",null,[z(n("span",{class:B({"content-status":!0,pending:t.status==="pending",success:t.status==="success",error:t.status.slice(0,5)==="error"})},l(t.status==="pending"?"待上传":t.status==="success"?"已上传":t.status.slice(5)),3),[[D,t.status!=="upload"]]),z(n("span",null,[n("progress",{max:"100",value:t.progress},null,8,X),n("span",J,l(t.progress)+"%",1)],512),[[D,t.status==="upload"]])]),n("span",null,[I(a(R),{class:"icon2",onClick:g=>F(t)},null,8,["onClick"])])]))),128))]),n("div",Q,[n("span",null,"文件数量："+l(a(v)),1),n("span",null,"成功上传："+l(a(_)),1),n("span",null,"总大小："+l(a(u)/1024/1024>1?(a(u)/1024/1024).toFixed(2)+"MB":a(u)/1024>1?(a(u)/1024).toFixed(2)+"KB":a(u)+"bype"),1),n("button",{class:B({isenable:!!r.value.length}),onClick:S},"开始上传",2)])]))}});const ee=G(Y,[["__scopeId","data-v-e6054a79"]]);export{ee as default};
